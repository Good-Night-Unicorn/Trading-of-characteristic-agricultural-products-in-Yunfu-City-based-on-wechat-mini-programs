(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-shop-order-confirm-shop-order-confirm"],{"83fd":function(t,e,o){"use strict";o.r(e);var n=o("daab"),a=o.n(n);for(var i in n)"default"!==i&&function(t){o.d(e,t,(function(){return n[t]}))}(i);e["default"]=a.a},"9dd2":function(t,e,o){var n=o("24fb"),a=o("1de5"),i=o("5d3e");e=n(!1);var s=a(i);e.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.avator[data-v-83e909de]{width:%?150?%;height:%?150?%;margin:%?20?% 0}.couponList[data-v-83e909de]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap;width:100%;background:#fff;padding:20px 20px 120px;max-height:60vh;overflow-y:scroll}.couponList .coupon[data-v-83e909de]{width:100%;background:url('+s+");background-repeat:no-repeat;background-position:50%;background-size:cover;padding:60px 30px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;position:relative}.couponList .coupon .no-coupon[data-v-83e909de]{position:absolute;width:80px;height:80px;right:20px;top:20px}.couponList .coupon .coupon_left[data-v-83e909de]{-webkit-box-flex:1;-webkit-flex:1;flex:1;color:#000}.couponList .coupon .coupon_left .name[data-v-83e909de]{font-size:22px;line-height:1.5}.couponList .coupon .coupon_left .date[data-v-83e909de]{font-size:14px;line-height:1.5}.couponList .coupon .coupon_left .date1[data-v-83e909de]{font-size:12px;line-height:1.5}.couponList .coupon .coupon_right[data-v-83e909de]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.couponList .coupon .coupon_right .price[data-v-83e909de]{color:#ff0800;font-size:20px;padding:0 0 10px}.couponList .coupon .coupon_right .price .num[data-v-83e909de]{font-size:28px}.couponList .coupon .coupon_right .btn[data-v-83e909de]{width:100px;height:30px;line-height:30px;border-radius:30px;background:#ff0800;text-align:center;color:#fff;font-size:18px;cursor:pointer}.couponList .coupons[data-v-83e909de]{-webkit-filter:grayscale(100%);filter:grayscale(100%)}.couponList .noList[data-v-83e909de]{color:#9e9e9e;width:100%;text-align:center;padding:60px 0}.couponList .clearCoupon[data-v-83e909de]{margin:0 auto;color:#666;font-size:12px}",""]),t.exports=e},b1b8:function(t,e,o){"use strict";o.r(e);var n=o("e95c"),a=o("83fd");for(var i in a)"default"!==i&&function(t){o.d(e,t,(function(){return a[t]}))}(i);o("cc4b");var s,r=o("f0c5"),u=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"83e909de",null,!1,n["a"],s);e["default"]=u.exports},cc4b:function(t,e,o){"use strict";var n=o("f48f"),a=o.n(n);a.a},daab:function(t,e,o){"use strict";var n=o("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o("28a5");var a=n(o("bd86"));o("96cf");var i=n(o("3b8d"));o("c5f6"),o("ac6a");var s={data:function(){return{user:{},orderGoods:{},address:{},total:0,type:1,seat:0,remark:"",couponList:[],nowCoupon:{},rightType:!1,name:""}},computed:{baseUrl:function(){return this.$base.url},totalPrice:function(){var t=0;return 1==this.seat?t=this.total:this.orderGoods.length&&this.orderGoods.forEach((function(e){t+=e.price*e.buynumber})),this.nowCoupon.id&&(t-=this.nowCoupon.discountamount),Number(t).toFixed(2)},couponName:function(){var t="";return this.nowCoupon.id&&(t="满".concat(this.nowCoupon.fullamount,"减").concat(this.nowCoupon.discountamount)),t||"选择优惠券"}},onLoad:function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(e){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.type=e.type,this.seat=e.seat,this.orderGoods=uni.getStorageSync("orderGoods"),this.changeShangpin(),1!=this.seat)for(o=0;o<this.orderGoods.length;o++)0==this.total?this.total=parseFloat(this.orderGoods[o].price)*this.orderGoods[o].buynumber:this.total=parseFloat(this.total)+parseFloat(this.orderGoods[o].price)*this.orderGoods[o].buynumber;else this.total=parseFloat(this.orderGoods[0].total),this.address=this.orderGoods[0].address;this.changePrice(),this.total=this.total.toFixed(2);case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onShow:function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(){var e,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=uni.getStorageSync("nowTable"),t.next=3,this.$api.session(e);case 3:if(o=t.sent,this.user=o.data,1==this.seat){t.next=15;break}if(n=uni.getStorageSync("address"),!n||this.user.id!=n.userid){t.next=11;break}this.address=uni.getStorageSync("address"),t.next=15;break;case 11:return t.next=13,this.$api.defaultAddress(this.user.id);case 13:o=t.sent,null!=o.data?this.address=o.data:this.address={};case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:{changeShangpin:function(){var t=this;1==this.orderGoods.length&&(this.rightType=!0);var e="";this.orderGoods.forEach((function(o,n){0==n?(e=o.shangjiazhanghao,t.rightType=!0):o.shangjiazhanghao!=e&&(t.rightType=!1)})),this.rightType&&(this.name=e)},clearCoupon:function(){this.nowCoupon={},this.changePrice(),this.$forceUpdate(),this.$refs.couponPopup.close()},couponClick:function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(){var e,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.page("mycoupon");case 2:e=t.sent,t.t0=regeneratorRuntime.keys(e.data.list);case 4:if((t.t1=t.t0()).done){t.next=18;break}if(o=t.t1.value,this.isBetweenTime(this.$utils.getCurDateTime(),[e.data.list[o].startime,e.data.list[o].endtime])||"已使用"==e.data.list[o].status||"已过期"==e.data.list[o].status){t.next=12;break}return e.data.list[o].status="已过期",t.next=10,this.$api.update("mycoupon",e.data.list[o]);case 10:t.next=16;break;case 12:if(!this.isBetweenTime(this.$utils.getCurDateTime(),[e.data.list[o].startime,e.data.list[o].endtime])||"已使用"==e.data.list[o].status||"可使用"==e.data.list[o].status){t.next=16;break}return e.data.list[o].status="可使用",t.next=16,this.$api.update("mycoupon",e.data.list[o]);case 16:t.next=4;break;case 18:this.couponList=e.data.list,this.$refs.couponPopup.open();case 20:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),isBetweenTime:function(t,e){var o=!0,n=new Date(t),a=new Date(e[0]),i=new Date(e[1]),s=n.getTime()-a.getTime(),r=n.getTime()-i.getTime();return(s<0||r>0)&&(o=!1),o},getCoupon:function(t){if(!this.changeStatus(t))return!1;this.nowCoupon=t,this.$refs.couponPopup.close(),this.changePrice()},changeStatus:function(t){var e=JSON.parse(JSON.stringify(this.totalPrice));if(this.nowCoupon.id&&(e=Number(e)+Number(this.nowCoupon.discountamount)),t.fullamount<Number(e)&&"可使用"==t.status){if(!t.shangjiazhanghao||!this.rightType)return!(t.shangjiazhanghao&&!this.rightType);if(t.shangjiazhanghao==this.name)return!0}return!1},changePrice:function(){var t=this,e=0;this.orderGoods.forEach((function(o){1==t.seat?e=o.total:e+=o.price*o.buynumber}));var o=0,n=0;this.orderGoods.forEach((function(a){n=1==t.seat?a.total:a.price*a.buynumber,t.nowCoupon.id&&(o=Number((Number(n.toFixed(2))/Number(e.toFixed(2))*t.nowCoupon.discountamount).toFixed(2))),n-=o,a.total=n.toFixed(2)})),this.$forceUpdate()},onSubmitTap:function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(){var e,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this,1==e.seat||e.address.address){t.next=4;break}return e.$utils.msg("请选择地址"),t.abrupt("return");case 4:o=uni.getStorageSync("nowTable"),n=Number(e.$utils.genTradeNo())+1,uni.showModal({title:"提示",content:"是否确认支付",success:function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(i){var s,r,u,c,d,p,l,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!i.confirm){t.next=65;break}if(s=e.type,r=!0,u="已支付",1!=s){t.next=8;break}e.user.money-e.totalPrice<0&&(e.$utils.msg("余额不足，请先充值"),r=!1,u="未支付",setTimeout((function(){uni.switchTab({url:"../center/center"})}),1500)),t.next=13;break;case 8:if(2!=s){t.next=13;break}if(!(e.user.jf-e.totalPrice<0)){t.next=13;break}return e.$utils.msg("积分不足，兑换商品失败"),r=!1,t.abrupt("return");case 13:c=0;case 14:if(!(c<e.orderGoods.length)){t.next=49;break}return t.next=17,e.$api.info("".concat(e.orderGoods[c].tablename),e.orderGoods[c].goodid);case 17:if(p=t.sent,!(p.data.onelimittimes>0)){t.next=23;break}if(!(e.orderGoods[c].buynumber>p.data.onelimittimes)){t.next=23;break}return e.$utils.msg("".concat(e.orderGoods[c].goodname,"超过可购买数量")),r=!1,t.abrupt("break",49);case 23:if(!(p.data.alllimittimes<e.orderGoods[c].buynumber)){t.next=29;break}return e.$utils.msg("".concat(e.orderGoods[c].goodname,"已售罄")),r=!1,t.abrupt("break",49);case 29:1!=e.seat&&(p.data.alllimittimes=p.data.alllimittimes-e.orderGoods[c].buynumber,0==p.data.alllimittimes&&(p.data.onshelves=0));case 30:if(d={orderid:e.$utils.genTradeNo(),tablename:e.orderGoods[c].tablename,userid:e.user.id,goodid:e.orderGoods[c].goodid,goodname:e.orderGoods[c].goodname,picture:e.orderGoods[c].picture,buynumber:e.orderGoods[c].buynumber,discountprice:e.orderGoods[c].price,price:e.orderGoods[c].price,total:e.orderGoods[c].total,discounttotal:e.orderGoods[c].total,type:s,remark:e.remark,sfsh:"",role:o,address:e.address.address,tel:e.address.phone,consignee:e.address.name,shangjiazhanghao:e.orderGoods[c].shangjiazhanghao,goodtype:e.orderGoods[c].goodtype},(0,a.default)(d,"goodtype",e.orderGoods[c].goodtype),(0,a.default)(d,"status",u),(0,a.default)(d,"orderno",n),l=d,!e.nowCoupon.id){t.next=37;break}return l.couponnumber=e.nowCoupon.couponnumber,l.discountamount=e.nowCoupon.discountamount,e.nowCoupon.status="已使用",t.next=37,e.$api.update("mycoupon",e.nowCoupon);case 37:return 1==e.seat&&(l["address"]=e.address,h=e.address.split(",").length,l["buynumber"]=h,l["total"]=e.orderGoods[c].total,l["discounttotal"]=e.orderGoods[c].total,uni.setStorageSync("selectedType",!0),p.data.selected?p.data.selected=p.data.selected+","+e.orderGoods[c].activeSeat:p.data.selected=e.orderGoods[c].activeSeat),t.next=40,e.$api.update("".concat(e.orderGoods[c].tablename),p.data);case 40:return t.next=42,e.$api.add("orders",l);case 42:if(!e.orderGoods[c].id){t.next=46;break}return t.next=45,e.$api.del("cart",JSON.stringify([e.orderGoods[c].id]));case 45:uni.removeStorageSync("cart".concat(e.orderGoods[c].goodid).concat(e.user.id));case 46:c++,t.next=14;break;case 49:if(!r){t.next=65;break}if(1!=s){t.next=59;break}return e.$utils.msgBack("支付成功"),e.user.money=Number((Number(e.user.money)-Number(e.totalPrice)).toFixed(2)),(e.user.jf||0==e.user.jf)&&(e.user.jf=Number((Number(e.user.jf)+Number(e.totalPrice)).toFixed(2))),t.next=56,e.$api.update(o,e.user);case 56:uni.setStorageSync("userSession",JSON.stringify(e.user)),t.next=65;break;case 59:if(2!=s){t.next=65;break}return e.$utils.msgBack("兑换成功"),e.user.jf=Number((Number(e.user.jf)-Number(e.totalPrice)).toFixed(2)),t.next=64,e.$api.update(o,e.user);case 64:uni.setStorageSync("userSession",JSON.stringify(e.user));case 65:case"end":return t.stop()}}),t)})));function s(e){return t.apply(this,arguments)}return s}()});case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onAddressTap:function(){this.$utils.jump("../shop-address/shop-address")}}};e.default=s},e95c:function(t,e,o){"use strict";var n={"uni-popup":o("1c89").default},a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"content"},[n("v-uni-form",[1!=t.seat?n("v-uni-view",{staticClass:"cu-form-group",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onAddressTap.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"title"},[t._v("地址")]),Object.keys(t.address).length?n("v-uni-view",[n("v-uni-view",[t._v(t._s(t.address.name)+" "+t._s(t.address.phone))]),n("v-uni-view",[t._v(t._s(t.address.address))])],1):t._e()],1):t._e(),n("v-uni-view",{staticClass:"cu-form-group"},[n("v-uni-view",{staticClass:"title"},[t._v("购买清单")])],1),t._l(t.orderGoods,(function(e,o){return n("v-uni-view",{key:o,staticClass:"cu-form-group"},[n("v-uni-image",{staticClass:"avator",attrs:{src:t.baseUrl+e.picture,mode:""}}),n("v-uni-view",{staticClass:"title"},[n("v-uni-view",[t._v(t._s(e.goodname))]),1!=t.seat?n("v-uni-view",[t._v("x"+t._s(e.buynumber)),1==t.type||3==t.type?n("v-uni-text",{staticStyle:{"margin-left":"30upx",color:"red"}},[t._v("￥"+t._s(e.total))]):t._e(),2==t.type?n("v-uni-text",{staticStyle:{"margin-left":"30upx",color:"red"}},[t._v(t._s(e.total)+"积分")]):t._e()],1):n("v-uni-view",[t._v(t._s(e.address)+"号"),1==t.type?n("v-uni-text",{staticStyle:{"margin-left":"30upx",color:"red"}},[t._v("￥"+t._s(e.total))]):t._e(),2==t.type?n("v-uni-text",{staticStyle:{"margin-left":"30upx",color:"red"}},[t._v(t._s(e.total)+"积分")]):t._e()],1)],1)],1)})),n("v-uni-view",{staticClass:"cu-form-group"},[1==t.type||3==t.type?n("v-uni-view",{staticClass:"title"},[t._v("总价")]):t._e(),2==t.type?n("v-uni-view",{staticClass:"title"},[t._v("总积分")]):t._e(),n("v-uni-view",[1==t.type||3==t.type?n("v-uni-text",[t._v("￥"+t._s(t.totalPrice))]):t._e(),2==t.type?n("v-uni-text",[t._v(t._s(t.total)+"积分")]):t._e()],1)],1),2!=t.type?n("v-uni-view",{staticClass:"cu-form-group"},[t._v("优惠券"),n("v-uni-input",{staticStyle:{"margin-left":"30upx",height:"60upx","font-size":"28rpx","text-align":"right"},attrs:{name:"remark"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.couponClick.apply(void 0,arguments)}},model:{value:t.couponName,callback:function(e){t.couponName=e},expression:"couponName"}})],1):t._e(),n("v-uni-view",{staticClass:"cu-form-group"},[t._v("备注"),n("v-uni-input",{staticStyle:{"margin-left":"30upx","border-bottom":"1px solid #999999",height:"60upx","font-size":"28rpx"},attrs:{name:"remark"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)],2),n("v-uni-view",{staticClass:"padding",staticStyle:{"text-align":"center"}},[1==t.type?n("v-uni-button",{staticClass:"bg-red lg",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onSubmitTap()}}},[t._v("确认支付")]):t._e(),2==t.type?n("v-uni-button",{staticClass:"bg-red lg",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onSubmitTap()}}},[t._v("确认兑换")]):t._e()],1),n("uni-popup",{ref:"couponPopup",staticClass:"popup-content",attrs:{type:"bottom"}},[n("v-uni-view",{staticClass:"couponList"},[t._l(t.couponList,(function(e,a){return n("v-uni-view",{key:a,staticClass:"coupon",class:t.changeStatus(e)?"":"coupons"},[n("v-uni-view",{staticClass:"coupon_left"},[n("v-uni-view",{staticClass:"name"},[t._v("满"+t._s(e.fullamount)+"减"+t._s(e.discountamount))]),n("v-uni-view",{staticClass:"date"},[t._v(t._s(e.startime)+"-"+t._s(e.endtime))]),n("v-uni-view",{staticClass:"date"},[t._v(t._s(e.remark))]),e.shangjiazhanghao?n("v-uni-view",{staticClass:"date1"},[t._v("仅限 "+t._s(e.shangjiazhanghao)+" 商品可使用")]):n("v-uni-view",{staticClass:"date1"},[t._v("全品类商品可使用")])],1),n("v-uni-view",{staticClass:"coupon_right"},[n("v-uni-view",{staticClass:"price"},[t._v("￥"),n("span",{staticClass:"num"},[t._v(t._s(e.discountamount))])]),"可使用"==e.status?n("v-uni-view",{staticClass:"btn",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.getCoupon(e)}}},[t._v(t._s(t.changeStatus(e)?"立即使用":"不满条件"))]):t._e()],1),"已过期"==e.status?n("img",{staticClass:"no-coupon",attrs:{src:o("d594"),alt:""}}):t._e(),"已使用"==e.status?n("img",{staticClass:"no-coupon",attrs:{src:o("f96e"),alt:""}}):t._e()],1)})),t.couponList.length?t._e():n("v-uni-view",{staticClass:"noList"},[t._v("暂无优惠券")]),n("v-uni-view",{staticClass:"clearCoupon",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearCoupon.apply(void 0,arguments)}}},[t._v("不使用优惠券")])],2)],1)],1)},i=[];o.d(e,"b",(function(){return a})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){return n}))},f48f:function(t,e,o){var n=o("9dd2");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=o("4f06").default;a("8e3e6f54",n,!0,{sourceMap:!1,shadowMode:!1})}}]);